generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime
  @@unique([identifier, token])
}

enum UserRole {
  USER
  MODERATOR
  ADMIN
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  role          UserRole  @default(USER)
  bio           String?
  phone         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  accounts Account[]
  sessions Session[]
  vehicles Vehicle[]
  posts    Post[]
  comments Comment[]
  plan          String  @default("free")
  stripeId      String?
  airaCredits   Int     @default(3)
  airaTokensUsed Int    @default(0)
}

model Vehicle {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  brand     String
  model     String
  year      Int
  body      String?
  fuel      String
  hp        Int?
  color     String?

  mileage       Int       @default(0)
  regRegion     String?
  regCountry    String    @default("US")
  vin           String?
  licensePlate  String?
  owners        Int       @default(1)

  drive         String?
  trans         String?
  accel         String?
  topSpeed      String?

  consumption   String?
  co2           String?
  battery       String?
  rangemi       String?

  weight        String?
  towCapacity   String?
  length        String?
  width         String?
  height        String?
  seats         Int?
  doors         Int?

  motorVariant  String?
  baseMotor     String?
  fuelType      String?
  baseFuel      String?
  driveVariant  String?
  transVariant  String?
  baseTrans     String?
  trimLevel     String?
  baseTrim      String?
  paintType     String?

  equipment     Json?
  extraEquip    Json?
  missingEquip  Json?
  deviations    Json?

  inspectionStatus  String?
  lastInspection    String?
  nextInspection    String?
  lastService       String?
  nextService       String?
  estimatedAnnualMi Int?
  serviceBook       Json?
  insurance         Json?
  warranties        Json?
  financing         Json?
  tires             Json?

  annualTax         Float   @default(0)
  monthlyFuelCost   Float?
  parkingCost       Float?
  washCost          Float?
  tollCost          Float?

  marketValue       Int?
  lastValuationDate DateTime?
  confidence        Int?

  imageUrl      String?

  status        String  @default("ok")
  statusText    String  @default("All Good")
  isPublic      Boolean @default(false)
  isForSale     Boolean @default(false)
  askingPrice   Int?

  @@index([userId])
  @@index([brand, model, year])
}

model Post {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  content   String   @db.Text
  images    Json?
  likes     Int      @default(0)
  type      String   @default("post")
  isHidden    Boolean @default(false)
  isFlagged   Boolean @default(false)
  flagReason  String?
  moderatedAt DateTime?
  moderatedBy String?
  comments Comment[]
  @@index([userId])
  @@index([createdAt])
}

model Comment {
  id        String   @id @default(cuid())
  postId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  content   String   @db.Text
  isHidden  Boolean  @default(false)
  @@index([postId])
}

model ValuationParam {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  label     String?
  category  String
  updatedAt DateTime @updatedAt
  updatedBy String?
  @@index([category])
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String
  action    String
  target    String?
  details   Json?
  createdAt DateTime @default(now())
  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

// Add this to the bottom of your existing schema.prisma file:

model AiraLog {
  id        String   @id @default(uuid())
  question  String
  answer    String
  model     String   @default("")
  createdAt DateTime @default(now())
}





